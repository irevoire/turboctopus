<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Welcome to the Meilisearch specifications!</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.b26ff90a.css" as="style"><link rel="preload" href="/assets/js/app.e6676148.js" as="script"><link rel="preload" href="/assets/js/3.4da56047.js" as="script"><link rel="preload" href="/assets/js/25.759f5cae.js" as="script"><link rel="prefetch" href="/assets/js/10.4bb9eeac.js"><link rel="prefetch" href="/assets/js/11.72b45679.js"><link rel="prefetch" href="/assets/js/12.2af66f08.js"><link rel="prefetch" href="/assets/js/13.167021d3.js"><link rel="prefetch" href="/assets/js/14.9305fa09.js"><link rel="prefetch" href="/assets/js/15.095125b3.js"><link rel="prefetch" href="/assets/js/16.166f3cec.js"><link rel="prefetch" href="/assets/js/17.052e3dd6.js"><link rel="prefetch" href="/assets/js/18.145cf324.js"><link rel="prefetch" href="/assets/js/19.54ac2cec.js"><link rel="prefetch" href="/assets/js/20.fe442e43.js"><link rel="prefetch" href="/assets/js/21.01b56736.js"><link rel="prefetch" href="/assets/js/22.9d7baf38.js"><link rel="prefetch" href="/assets/js/23.06e68601.js"><link rel="prefetch" href="/assets/js/24.71bff866.js"><link rel="prefetch" href="/assets/js/26.719ff326.js"><link rel="prefetch" href="/assets/js/27.178e5c36.js"><link rel="prefetch" href="/assets/js/28.d2c2cee7.js"><link rel="prefetch" href="/assets/js/29.239d404a.js"><link rel="prefetch" href="/assets/js/30.06e60030.js"><link rel="prefetch" href="/assets/js/31.7ce04ec7.js"><link rel="prefetch" href="/assets/js/32.3d0e4e96.js"><link rel="prefetch" href="/assets/js/33.91d80bc8.js"><link rel="prefetch" href="/assets/js/34.1ae80f5b.js"><link rel="prefetch" href="/assets/js/35.09e8f62f.js"><link rel="prefetch" href="/assets/js/36.15b16bf9.js"><link rel="prefetch" href="/assets/js/37.1d009b1c.js"><link rel="prefetch" href="/assets/js/38.651ab4ec.js"><link rel="prefetch" href="/assets/js/39.3ffdfa45.js"><link rel="prefetch" href="/assets/js/4.aaee11b0.js"><link rel="prefetch" href="/assets/js/40.d707c5be.js"><link rel="prefetch" href="/assets/js/41.65027914.js"><link rel="prefetch" href="/assets/js/42.0ada06ba.js"><link rel="prefetch" href="/assets/js/43.af7cbf45.js"><link rel="prefetch" href="/assets/js/44.d3d1a586.js"><link rel="prefetch" href="/assets/js/45.94f10b5f.js"><link rel="prefetch" href="/assets/js/46.9e997213.js"><link rel="prefetch" href="/assets/js/47.49c151b7.js"><link rel="prefetch" href="/assets/js/48.b1af9c47.js"><link rel="prefetch" href="/assets/js/49.61a203fe.js"><link rel="prefetch" href="/assets/js/5.06848b4d.js"><link rel="prefetch" href="/assets/js/50.5561182d.js"><link rel="prefetch" href="/assets/js/51.320631dd.js"><link rel="prefetch" href="/assets/js/52.b777542a.js"><link rel="prefetch" href="/assets/js/53.f57a89e9.js"><link rel="prefetch" href="/assets/js/54.aab35d92.js"><link rel="prefetch" href="/assets/js/55.16d1a9db.js"><link rel="prefetch" href="/assets/js/56.f8afd4eb.js"><link rel="prefetch" href="/assets/js/57.6e1d5d7b.js"><link rel="prefetch" href="/assets/js/58.b103820c.js"><link rel="prefetch" href="/assets/js/59.79acfddd.js"><link rel="prefetch" href="/assets/js/6.87f02c74.js"><link rel="prefetch" href="/assets/js/60.df174b2b.js"><link rel="prefetch" href="/assets/js/61.6a669f3a.js"><link rel="prefetch" href="/assets/js/62.3ac8f506.js"><link rel="prefetch" href="/assets/js/63.39c14cc1.js"><link rel="prefetch" href="/assets/js/64.53965336.js"><link rel="prefetch" href="/assets/js/65.509d9e2e.js"><link rel="prefetch" href="/assets/js/66.74682a96.js"><link rel="prefetch" href="/assets/js/67.6322aeae.js"><link rel="prefetch" href="/assets/js/68.7ce3facc.js"><link rel="prefetch" href="/assets/js/7.fadbe260.js"><link rel="prefetch" href="/assets/js/8.e63f62a9.js"><link rel="prefetch" href="/assets/js/9.0c014273.js"><link rel="prefetch" href="/assets/js/vendors~docs-searchbar.9a2822a3.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b26ff90a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Welcome to the Meilisearch specifications!</span></a> <div class="links"><form id="search-form" role="search" class="meilisearch-search-wrapper search-box"><input id="meilisearch-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/specifications/text/specifications/text/0000-specification-template.html" class="nav-link">
  Specification
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/specifications/text/specifications/text/0000-specification-template.html" class="nav-link">
  Specification
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/specifications/text/0000-specification-template.html" class="sidebar-link">Specification template</a></li><li><a href="/specifications/text/0001-frontend-disable-prod.html" class="sidebar-link">Frontend disable prod</a></li><li><a href="/specifications/text/0001-script-based-tokenizer.html" class="sidebar-link">Script based tokenizer</a></li><li><a href="/specifications/text/0028-indexing-csv.html" class="sidebar-link">Indexing csv</a></li><li><a href="/specifications/text/0029-indexing-ndjson.html" class="sidebar-link">Indexing ndjson</a></li><li><a href="/specifications/text/0032-distinct-attribute.html" class="sidebar-link">Distinct attribute</a></li><li><a href="/specifications/text/0033-logging.html" class="sidebar-link">Logging</a></li><li><a href="/specifications/text/0034-telemetry-policies.html" class="sidebar-link">Telemetry policies</a></li><li><a href="/specifications/text/0038-rename-attributes-for-faceting.html" class="sidebar-link">Rename attributes for faceting</a></li><li><a href="/specifications/text/0043-phrase-query.html" class="sidebar-link">Phrase query</a></li><li><a href="/specifications/text/0047-reset-stop-words-synonyms-settings-with-null.html" class="sidebar-link">Reset stop words synonyms settings with null</a></li><li><a href="/specifications/text/0048-rename-max-mdb-size-var.html" class="sidebar-link">Rename max mdb size var</a></li><li><a href="/specifications/text/0055-sort.html" class="sidebar-link">Sort</a></li><li><a href="/specifications/text/0059-geo-search.html" aria-current="page" class="active sidebar-link">Geo search</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/specifications/text/0059-geo-search.html#_1-functional-specification" class="sidebar-link">1. Functional Specification</a></li><li class="sidebar-sub-header"><a href="/specifications/text/0059-geo-search.html#_2-technical-aspects" class="sidebar-link">2. Technical Aspects</a></li><li class="sidebar-sub-header"><a href="/specifications/text/0059-geo-search.html#_3-future-possibilities" class="sidebar-link">3. Future Possibilities</a></li></ul></li><li><a href="/specifications/text/0060-tasks-api.html" class="sidebar-link">Tasks api</a></li><li><a href="/specifications/text/0061-error-format-and-definitions.html" class="sidebar-link">Error format and definitions</a></li><li><a href="/specifications/text/0077-words-position-limit.html" class="sidebar-link">Words position limit</a></li><li><a href="/specifications/text/0085-api-keys.html" class="sidebar-link">Api keys</a></li><li><a href="/specifications/text/0089-tenant-tokens.html" class="sidebar-link">Tenant tokens</a></li><li><a href="/specifications/text/0096-auto-batching.html" class="sidebar-link">Auto batching</a></li><li><a href="/specifications/text/0105-dumps-api.html" class="sidebar-link">Dumps api</a></li><li><a href="/specifications/text/0117-typo-tolerance-setting-api.html" class="sidebar-link">Typo tolerance setting api</a></li><li><a href="/specifications/text/0118-search-api.html" class="sidebar-link">Search api</a></li><li><a href="/specifications/text/0119-instance-options.html" class="sidebar-link">Instance options</a></li><li><a href="/specifications/text/0121-data-types.html" class="sidebar-link">Data types</a></li><li><a href="/specifications/text/0123-displayed-attributes-setting-api.html" class="sidebar-link">Displayed attributes setting api</a></li><li><a href="/specifications/text/0123-distinct-attribute-setting-api.html" class="sidebar-link">Distinct attribute setting api</a></li><li><a href="/specifications/text/0123-filterable-attributes-setting-api.html" class="sidebar-link">Filterable attributes setting api</a></li><li><a href="/specifications/text/0123-proximity-precision.html" class="sidebar-link">Proximity precision</a></li><li><a href="/specifications/text/0123-ranking-rules-setting-api.html" class="sidebar-link">Ranking rules setting api</a></li><li><a href="/specifications/text/0123-searchable-attributes-setting-api.html" class="sidebar-link">Searchable attributes setting api</a></li><li><a href="/specifications/text/0123-separators-settings-api.html" class="sidebar-link">Separators settings api</a></li><li><a href="/specifications/text/0123-settings-api.html" class="sidebar-link">Settings api</a></li><li><a href="/specifications/text/0123-sortable-attributes-setting-api.html" class="sidebar-link">Sortable attributes setting api</a></li><li><a href="/specifications/text/0123-stop-words-setting-api.html" class="sidebar-link">Stop words setting api</a></li><li><a href="/specifications/text/0123-synonyms-setting-api.html" class="sidebar-link">Synonyms setting api</a></li><li><a href="/specifications/text/0123-user-dictionary-settings-api.html" class="sidebar-link">User dictionary settings api</a></li><li><a href="/specifications/text/0124-documents-api.html" class="sidebar-link">Documents api</a></li><li><a href="/specifications/text/0132-indexes-api.html" class="sidebar-link">Indexes api</a></li><li><a href="/specifications/text/0134-stats-api.html" class="sidebar-link">Stats api</a></li><li><a href="/specifications/text/0135-indexing-json.html" class="sidebar-link">Indexing json</a></li><li><a href="/specifications/text/0136-documents-soft-deletion.html" class="sidebar-link">Documents soft deletion</a></li><li><a href="/specifications/text/0171-version-api.html" class="sidebar-link">Version api</a></li><li><a href="/specifications/text/0172-health-api.html" class="sidebar-link">Health api</a></li><li><a href="/specifications/text/0174-metrics-api.html" class="sidebar-link">Metrics api</a></li><li><a href="/specifications/text/0178-compression-headers.html" class="sidebar-link">Compression headers</a></li><li><a href="/specifications/text/0185-configuration-file.html" class="sidebar-link">Configuration file</a></li><li><a href="/specifications/text/0191-swap-indexes-api.html" class="sidebar-link">Swap indexes api</a></li><li><a href="/specifications/text/0192-multi-search-api.html" class="sidebar-link">Multi search api</a></li><li><a href="/specifications/text/0193-experimental-features.html" class="sidebar-link">Experimental features</a></li><li><a href="/specifications/text/0194-experimental-feature-api.html" class="sidebar-link">Experimental feature api</a></li><li><a href="/specifications/text/0195-ranking-score.html" class="sidebar-link">Ranking score</a></li><li><a href="/specifications/text/0246-facet-search-api.html" class="sidebar-link">Facet search api</a></li><li><a href="/specifications/text/0258-snapshots-api.html" class="sidebar-link">Snapshots api</a></li><li><a href="/specifications/text/0262-task-queue-webhook.html" class="sidebar-link">Task queue webhook</a></li><li><a href="/specifications/text/157-faceting-setting-api.html" class="sidebar-link">Aceting setting api</a></li><li><a href="/specifications/text/157-pagination-setting-api.html" class="sidebar-link">Agination setting api</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><ul><li>Title: Geosearch</li> <li>Start Date: 2021-08-02</li> <li>Specification PR: <a href="https://github.com/meilisearch/specifications/pull/59" target="_blank" rel="noopener noreferrer">#59<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>Discovery Issue: <a href="https://github.com/meilisearch/product/issues/42" target="_blank" rel="noopener noreferrer">#42<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h1 id="geosearch"><a href="#geosearch" class="header-anchor">#</a> Geosearch</h1> <h2 id="_1-functional-specification"><a href="#_1-functional-specification" class="header-anchor">#</a> 1. Functional Specification</h2> <h3 id="i-summary"><a href="#i-summary" class="header-anchor">#</a> I. Summary</h3> <p>The purpose of this specification is to add a first iteration of the <strong>geosearch</strong> feature to give geo-filtering and geosorting capabilities at search time.</p> <h4 id="summary-key-points"><a href="#summary-key-points" class="header-anchor">#</a> Summary Key points</h4> <ul><li>Documents MUST have a <code>_geo</code> reserved object to be geosearchable.</li> <li>Filter documents by a given geo radius using the built-in filter <code>_geoRadius({lat}, {lng}, {distance_in_meters})</code>.</li> <li>Filter documents by a given geo bounding box using the built-in filter <code>_geoBoundingBox([{lat}, {lng}], [{lat, lng}])</code>. The first pair of coordinates represents the top right corner of the bounding box, while the second pair represents the bottom left corner.</li> <li>It is possible to cumulate several geosearch filters within the <code>filter</code> field.</li> <li>Sort documents in ascending/descending order around a geo point. e.g. <code>_geoPoint({lat}, {lng}):asc</code>.</li> <li>It is possible to filter and/or sort by geographical criteria of the user's choice.</li> <li><code>_geo</code> must be set as a filterable attribute to use geo filtering capabilities.</li> <li><code>_geo</code> must be set as a sortable attribute to use geo sort capabilities.</li> <li>There is no <code>geo</code> ranking rule that can be manipulated by the user. This one is automatically integrated in the ranking rule <code>sort</code> by default and activated by sorting using the <code>_geoPoint({lat}, {lng})</code> built-in sort rule.</li> <li>Using <code>_geoPoint({lat}, {lng})</code> in the <code>sort</code> parameter at search leads the engine to return a <code>_geoDistance</code> within the search results. This field represents the distance in meters of the document from the specified <code>_geoPoint</code>.</li></ul> <h3 id="ii-motivation"><a href="#ii-motivation" class="header-anchor">#</a> II. Motivation</h3> <p>According to our user feedback, the lack of a geosearch feature is mentioned as one of the biggest deal-breakers for choosing MeiliSearch as a search engine. A search engine must offer this feature. Some use cases specifically require integrated geosearch capabilities. Moreover, a lot of direct competitors offer it. Users today must find workarounds like using geohash to be able to geosearch documents. We hope to better serve the needs of users by implementing this feature. It allows multiplying the use-cases to which MeiliSearch can respond.</p> <h3 id="iii-technical-explanations"><a href="#iii-technical-explanations" class="header-anchor">#</a> III. Technical Explanations</h3> <h4 id="as-a-developer-i-want-to-add-geospatial-coordinates-to-a-document-so-that-the-document-can-be-geosearchable"><a href="#as-a-developer-i-want-to-add-geospatial-coordinates-to-a-document-so-that-the-document-can-be-geosearchable" class="header-anchor">#</a> <strong>As a developer, I want to add geospatial coordinates to a document so that the document can be geosearchable.</strong></h4> <ul><li>Introduce a reserved field <code>_geo</code> for documents to store geo spatial data from an <strong>object</strong> made of <code>lat</code> and <code>lng</code> fields for a <strong>JSON format</strong>. If the <code>_geo</code> field is set to <code>null</code>, my document won't be geosearchable.</li> <li>Introduce a reserved column <code>_geo</code> for documents to store geo spatial data from a <strong>string</strong> made of <code>lat,lng</code> for a <strong>CSV format</strong>.</li></ul> <h5 id="json-format"><a href="#json-format" class="header-anchor">#</a> <strong>JSON Format</strong></h5> <p><strong><code>_geo</code> field definition</strong></p> <ul><li>Name: <code>_geo</code></li> <li>Type: Object</li> <li>Format: <code>{lat:number|string, lng:number|string}</code></li> <li>Not required</li></ul> <blockquote><p>💡 if <code>_geo</code> is found in the document payload, <code>lat</code> and <code>lng</code> are required.
💡 <code>lat</code> and <code>lng</code> must be of float value.
💡 <code>lat</code> and <code>lng</code> field type can be mixed. e.g. <code>lat</code> can be a string while <code>lng</code> is a number in the same <code>_geo</code> object.</p></blockquote> <h5 id="csv-format"><a href="#csv-format" class="header-anchor">#</a> <strong>CSV Format</strong></h5> <p>Following the format already defined in the https://github.com/meilisearch/specifications/pull/28/files specification for document indexing from a CSV format. A reserved column <code>_geo</code> can be added to specify the geographical coordinates of a document.</p> <p>csv format example</p> <div class="language- extra-class"><pre class="language-text"><code>&quot;id:number&quot;,&quot;label&quot;,&quot;brand&quot;,&quot;_geo&quot;
&quot;1&quot;,&quot;F40&quot;,&quot;Ferrari&quot;,&quot;48.862725,2.287592&quot;
</code></pre></div><p><strong><code>_geo</code> column definition</strong></p> <ul><li>Name: <code>_geo</code></li> <li>Type: String</li> <li>Format: <code>&quot;lat:float,lng:float&quot;</code></li> <li>Not required</li></ul> <h4 id="post-add-or-replace-documents-indexes-indexuid-documents"><a href="#post-add-or-replace-documents-indexes-indexuid-documents" class="header-anchor">#</a> POST Add or replace documents <code>/indexes/{indexUid}/documents</code></h4> <h5 id="request-body"><a href="#request-body" class="header-anchor">#</a> Request body</h5> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">&quot;label&quot;</span><span class="token operator">:</span> <span class="token string">&quot;F40&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;brand&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Ferrari&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;_geo&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;lat&quot;</span><span class="token operator">:</span> <span class="token number">48.862725</span><span class="token punctuation">,</span>
            <span class="token property">&quot;lng&quot;</span><span class="token operator">:</span> <span class="token number">2.287592</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><h5 id="_202-accepted-response-body"><a href="#_202-accepted-response-body" class="header-anchor">#</a> 202 Accepted - Response body</h5> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;updateId&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="put-add-or-replace-documents-indexes-indexuid-documents"><a href="#put-add-or-replace-documents-indexes-indexuid-documents" class="header-anchor">#</a> PUT Add or replace documents <code>/indexes/{indexUid}/documents</code></h4> <h5 id="request-body-2"><a href="#request-body-2" class="header-anchor">#</a> Request body</h5> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">&quot;brand&quot;</span><span class="token operator">:</span> <span class="token string">&quot;F40 LM&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;brand&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Ferrari&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;_geo&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;lat&quot;</span><span class="token operator">:</span> <span class="token string">&quot;48.862725&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;lng&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2.287592&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><h5 id="_202-accepted-response-body-2"><a href="#_202-accepted-response-body-2" class="header-anchor">#</a> 202 Accepted - Response body</h5> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;updateId&quot;</span><span class="token operator">:</span> <span class="token number">2</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>🔴 Giving a bad formed <code>_geo</code> that do not conform to the format causes the <code>task</code> payload to fail and returns an <a href="/specifications/text/0061-error-format-and-definitions.html#invalid_document_geo_field">invalid_document_geo_field</a> error.</li></ul> <hr> <h3 id="as-an-end-user-i-want-to-filter-documents-within-a-geo-radius"><a href="#as-an-end-user-i-want-to-filter-documents-within-a-geo-radius" class="header-anchor">#</a> <strong>As an end-user, I want to filter documents within a geo radius.</strong></h3> <ul><li>Introduce a <code>_geoRadius({lat}, {lng}, {distance_in_meters})</code> built-in filter rule  to <code>filter</code> documents in a geo radius.shape.</li></ul> <p><strong><code>_geoRadius</code> built-in filter rule definition</strong></p> <ul><li>Name: <code>_geoRadius</code></li> <li>Signature: ({lat:float}:required, {lng:float}:required, {distance_in_meters:int}:required)</li> <li>Not required</li> <li><code>distance_in_meters</code> only accepts positive value.</li></ul> <blockquote><p>The <code>_geo</code> field has to be set in <code>filterableAttributes</code> setting by the developer to activate geo filtering capabilities at search.</p></blockquote> <p><strong><code>_geoBoundingBox</code> built-in filter rule definition</strong></p> <ul><li>Name: <code>_geoBoundingBox</code></li> <li>Signature: ([{lat:float}:required, {lng:float}:required)], [{lat:float}:required, {lng:float}:required])</li> <li>Not required</li></ul> <p>The first pair of coordinates represents the top right corner of the bounding box, while the second pair represents the bottom left corner.</p> <blockquote><p>The <code>_geo</code> field has to be set in <code>filterableAttributes</code> setting by the developer to activate geo filtering capabilities at search.</p></blockquote> <h4 id="get-search-indexes-indexuid-search"><a href="#get-search-indexes-indexuid-search" class="header-anchor">#</a> GET Search <code>/indexes/{indexUid}/search</code></h4> <div class="language- extra-class"><pre class="language-text"><code>...&amp;filter=&quot;brand=Mercedes AND _geoRadius(48.862725, 2.287592, 2000)&quot;`
</code></pre></div><h4 id="post-search-indexes-indexuid-search"><a href="#post-search-indexes-indexuid-search" class="header-anchor">#</a> POST Search <code>/indexes/{indexUid}/search</code></h4> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;filter&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;brand = Ferrari&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;_geoRadius(48.862725, 2.287592, 2000)&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>🔴 Specifying parameters that do not conform to the <code>_geoRadius</code> or <code>_geoBoundingBox</code> signature causes the API to return an <a href="/specifications/text/0061-error-format-and-definitions.html#invalid_search_parameter_filter">invalid_search_parameter_filter</a> error.</li> <li>🔴 Using <code>_geoDistance</code>, <code>_geo</code> or <code>_geoPoint</code> in a filter expression causes the API to return an <a href="/specifications/text/0061-error-format-and-definitions.html#invalid_search_parameter_filter">invalid_search_parameter_filter</a> error.</li></ul> <hr> <h3 id="as-an-end-user-i-want-to-sort-documents-around-a-geo-point"><a href="#as-an-end-user-i-want-to-sort-documents-around-a-geo-point" class="header-anchor">#</a> <strong>As an end-user, I want to sort documents around a geo point.</strong></h3> <ul><li>Introduce a <code>_geoPoint({lat}, {lng})</code> function parameter to <code>sort</code> documents around a central point.</li></ul> <p><strong><code>_geoPoint</code> built-in sort rule definition</strong></p> <ul><li>Name: <code>_geoPoint</code></li> <li>Signature: ({lat:float}:required, {lng:float}:required)</li> <li>Not required</li></ul> <p>Following the <a href="https://github.com/meilisearch/specifications/pull/55" target="_blank" rel="noopener noreferrer"><code>sort</code> specification feature<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>:</p> <blockquote><p>The <code>_geo</code> field has to be set in <code>sortableAttributes</code> setting by the developer to activate geo sorting capabilities at search.</p> <p>There is no <code>geo</code> ranking rule as such. It is in fact within the <code>sort</code> ranking rule in an obfuscated way.</p> <p><code>_geoPoint</code> built-in sort rule can sort documents in ascending/descending order.</p></blockquote> <h4 id="get-search-indexes-indexuid-search-2"><a href="#get-search-indexes-indexuid-search-2" class="header-anchor">#</a> GET Search <code>/indexes/{indexUid}/search</code></h4> <div class="language- extra-class"><pre class="language-text"><code>    ...&amp;sort=_geoPoint({lat, lng}):asc,price:desc
</code></pre></div><h4 id="post-search-indexes-indexuid-search-2"><a href="#post-search-indexes-indexuid-search-2" class="header-anchor">#</a> POST Search <code>/indexes/{indexUid}/search</code></h4> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;sort&quot;</span><span class="token operator">:</span> <span class="token string">&quot;_geoPoint({lat, lng}):asc,price:desc&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>🔴 Specifying parameters that do not conform to the <code>_geoPoint</code> signature causes the API to return an <a href="/specifications/text/0061-error-format-and-definitions.html#invalid_search_parameter_sort">invalid_search_parameter_sort</a> error.</li> <li>🔴 Using <code>_geoDistance</code>, <code>_geo</code>, <code>_geoRadius</code> or <code>_geoBoundingBox</code> in a sort expression causes the API to return an<a href="/specifications/text/0061-error-format-and-definitions.html#invalid_search_parameter_sort">invalid_search_parameter_sort</a> error.</li></ul> <hr> <h3 id="as-an-end-user-i-want-to-know-the-document-distance-when-i-am-sorting-around-a-geo-point"><a href="#as-an-end-user-i-want-to-know-the-document-distance-when-i-am-sorting-around-a-geo-point" class="header-anchor">#</a> <strong>As an end-user, I want to know the document distance when I am sorting around a geo point.</strong></h3> <ul><li>Introduce a <code>_geoDistance</code> parameter to the search result <code>hit</code> object.</li></ul> <p><strong><code>_geoDistance</code> field definition</strong></p> <ul><li>Name: <code>_geoDistance</code></li> <li>Description: Return document distance when the end-user sorts document from a <code>_geoPoint</code> in meters.</li> <li>Type: int</li> <li>Not required</li></ul> <blockquote><p>💡 <code>_geoDistance</code> response field is only computed and shown when the end-user have sorted documents around a <code>_geoPoint</code>. So if the end-user filters documents using a <code>_geoRadius/_geoBoundingBox</code> built-in filter without sorting them around a <code>_geoPoint</code>, this field <code>_geoDistance</code> will not appear in the search response.</p></blockquote> <hr> <h4 id="related-ranking-rules-settings-api-errors"><a href="#related-ranking-rules-settings-api-errors" class="header-anchor">#</a> Related Ranking Rules Settings API Errors</h4> <ul><li>🔴 Specifying a custom ranking rule with <code>_geo</code>, <code>_geoDistance</code>, <code>_geoPoint</code>, <code>_geoRadius</code> or <code>_geoBoundinBox</code> returns an <a href="/specifications/text/0061-error-format-and-definitions.html#invalid_settings_ranking_rules">invalid_settings_ranking_rules</a> error.</li></ul> <hr> <h2 id="_2-technical-aspects"><a href="#_2-technical-aspects" class="header-anchor">#</a> 2. Technical Aspects</h2> <h3 id="i-measuring"><a href="#i-measuring" class="header-anchor">#</a> I. Measuring</h3> <ul><li><code>filterableAttribute</code> setting definition to evaluate <code>_geo</code> presence.</li> <li><code>sortableAttribute</code> setting definition to evaluate <code>_geo</code> presence.</li></ul> <h2 id="_3-future-possibilities"><a href="#_3-future-possibilities" class="header-anchor">#</a> 3. Future Possibilities</h2> <ul><li>Add built-in filter to filter documents within <code>polygon</code>.</li> <li>Handling array of geo points in the document object.</li> <li>Handling distance in other formats (like the imperial format). <strong>It's easy to implement on the user side though.</strong></li> <li>Handling position in other formats. It seems that <a href="https://www.pacioos.hawaii.edu/voyager-news/lat-long-formats/" target="_blank" rel="noopener noreferrer">degrees and minutes<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> are also used a lot. <strong>It's easy to implement on the user side though.</strong></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/specifications/text/0055-sort.html" class="prev">
        Sort
      </a></span> <span class="next"><a href="/specifications/text/0060-tasks-api.html">
        Tasks api
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.e6676148.js" defer></script><script src="/assets/js/3.4da56047.js" defer></script><script src="/assets/js/25.759f5cae.js" defer></script>
  </body>
</html>
