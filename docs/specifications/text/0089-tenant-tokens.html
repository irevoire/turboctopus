<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Welcome to the Meilisearch specifications!</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.b26ff90a.css" as="style"><link rel="preload" href="/assets/js/app.9e995259.js" as="script"><link rel="preload" href="/assets/js/3.4da56047.js" as="script"><link rel="preload" href="/assets/js/30.05c7bec9.js" as="script"><link rel="prefetch" href="/assets/js/10.15aff203.js"><link rel="prefetch" href="/assets/js/11.b7de9b10.js"><link rel="prefetch" href="/assets/js/12.31781feb.js"><link rel="prefetch" href="/assets/js/13.5ee4202d.js"><link rel="prefetch" href="/assets/js/14.9305fa09.js"><link rel="prefetch" href="/assets/js/15.8b51dfec.js"><link rel="prefetch" href="/assets/js/16.a7c6842a.js"><link rel="prefetch" href="/assets/js/17.052e3dd6.js"><link rel="prefetch" href="/assets/js/18.145cf324.js"><link rel="prefetch" href="/assets/js/19.54ac2cec.js"><link rel="prefetch" href="/assets/js/20.fe442e43.js"><link rel="prefetch" href="/assets/js/21.01b56736.js"><link rel="prefetch" href="/assets/js/22.9d7baf38.js"><link rel="prefetch" href="/assets/js/23.06e68601.js"><link rel="prefetch" href="/assets/js/24.71bff866.js"><link rel="prefetch" href="/assets/js/25.759f5cae.js"><link rel="prefetch" href="/assets/js/26.719ff326.js"><link rel="prefetch" href="/assets/js/27.178e5c36.js"><link rel="prefetch" href="/assets/js/28.d2c2cee7.js"><link rel="prefetch" href="/assets/js/29.239d404a.js"><link rel="prefetch" href="/assets/js/31.7ce04ec7.js"><link rel="prefetch" href="/assets/js/32.88319e61.js"><link rel="prefetch" href="/assets/js/33.91d80bc8.js"><link rel="prefetch" href="/assets/js/34.b5b8f566.js"><link rel="prefetch" href="/assets/js/35.6f79f9fa.js"><link rel="prefetch" href="/assets/js/36.db871ac4.js"><link rel="prefetch" href="/assets/js/37.d6ad704c.js"><link rel="prefetch" href="/assets/js/38.651ab4ec.js"><link rel="prefetch" href="/assets/js/39.208b87d1.js"><link rel="prefetch" href="/assets/js/4.aaee11b0.js"><link rel="prefetch" href="/assets/js/40.d0feb147.js"><link rel="prefetch" href="/assets/js/41.5656ff34.js"><link rel="prefetch" href="/assets/js/42.abb4f81a.js"><link rel="prefetch" href="/assets/js/43.af7cbf45.js"><link rel="prefetch" href="/assets/js/44.97d19d44.js"><link rel="prefetch" href="/assets/js/45.6c35ad02.js"><link rel="prefetch" href="/assets/js/46.7f495a96.js"><link rel="prefetch" href="/assets/js/47.bf881f32.js"><link rel="prefetch" href="/assets/js/48.77bf2ff1.js"><link rel="prefetch" href="/assets/js/49.9d6fd16d.js"><link rel="prefetch" href="/assets/js/5.06848b4d.js"><link rel="prefetch" href="/assets/js/50.79df3dcc.js"><link rel="prefetch" href="/assets/js/51.baecf094.js"><link rel="prefetch" href="/assets/js/52.c36008c5.js"><link rel="prefetch" href="/assets/js/53.d16d1983.js"><link rel="prefetch" href="/assets/js/54.70550584.js"><link rel="prefetch" href="/assets/js/55.166e6f41.js"><link rel="prefetch" href="/assets/js/56.dfe45e94.js"><link rel="prefetch" href="/assets/js/57.4dbfa071.js"><link rel="prefetch" href="/assets/js/58.b103820c.js"><link rel="prefetch" href="/assets/js/59.fcb2ec42.js"><link rel="prefetch" href="/assets/js/6.87f02c74.js"><link rel="prefetch" href="/assets/js/60.df174b2b.js"><link rel="prefetch" href="/assets/js/61.b3bf19f9.js"><link rel="prefetch" href="/assets/js/62.371c5b80.js"><link rel="prefetch" href="/assets/js/63.39c14cc1.js"><link rel="prefetch" href="/assets/js/64.e6f9b837.js"><link rel="prefetch" href="/assets/js/65.cb3ec6ff.js"><link rel="prefetch" href="/assets/js/66.74682a96.js"><link rel="prefetch" href="/assets/js/67.6322aeae.js"><link rel="prefetch" href="/assets/js/68.7ce3facc.js"><link rel="prefetch" href="/assets/js/7.fadbe260.js"><link rel="prefetch" href="/assets/js/8.e63f62a9.js"><link rel="prefetch" href="/assets/js/9.946c989d.js"><link rel="prefetch" href="/assets/js/vendors~docs-searchbar.9a2822a3.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b26ff90a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Welcome to the Meilisearch specifications!</span></a> <div class="links"><form id="search-form" role="search" class="meilisearch-search-wrapper search-box"><input id="meilisearch-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/specifications/text/specifications/text/0000-specification-template.html" class="nav-link">
  Specification
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/specifications/text/specifications/text/0000-specification-template.html" class="nav-link">
  Specification
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/specifications/text/0000-specification-template.html" class="sidebar-link">Specification template</a></li><li><a href="/specifications/text/0001-frontend-disable-prod.html" class="sidebar-link">Frontend disable prod</a></li><li><a href="/specifications/text/0001-script-based-tokenizer.html" class="sidebar-link">Script based tokenizer</a></li><li><a href="/specifications/text/0028-indexing-csv.html" class="sidebar-link">Indexing csv</a></li><li><a href="/specifications/text/0029-indexing-ndjson.html" class="sidebar-link">Indexing ndjson</a></li><li><a href="/specifications/text/0032-distinct-attribute.html" class="sidebar-link">Distinct attribute</a></li><li><a href="/specifications/text/0033-logging.html" class="sidebar-link">Logging</a></li><li><a href="/specifications/text/0034-telemetry-policies.html" class="sidebar-link">Telemetry policies</a></li><li><a href="/specifications/text/0038-rename-attributes-for-faceting.html" class="sidebar-link">Rename attributes for faceting</a></li><li><a href="/specifications/text/0043-phrase-query.html" class="sidebar-link">Phrase query</a></li><li><a href="/specifications/text/0047-reset-stop-words-synonyms-settings-with-null.html" class="sidebar-link">Reset stop words synonyms settings with null</a></li><li><a href="/specifications/text/0048-rename-max-mdb-size-var.html" class="sidebar-link">Rename max mdb size var</a></li><li><a href="/specifications/text/0055-sort.html" class="sidebar-link">Sort</a></li><li><a href="/specifications/text/0059-geo-search.html" class="sidebar-link">Geo search</a></li><li><a href="/specifications/text/0060-tasks-api.html" class="sidebar-link">Tasks api</a></li><li><a href="/specifications/text/0061-error-format-and-definitions.html" class="sidebar-link">Error format and definitions</a></li><li><a href="/specifications/text/0077-words-position-limit.html" class="sidebar-link">Words position limit</a></li><li><a href="/specifications/text/0085-api-keys.html" class="sidebar-link">Api keys</a></li><li><a href="/specifications/text/0089-tenant-tokens.html" aria-current="page" class="active sidebar-link">Tenant tokens</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/specifications/text/0089-tenant-tokens.html#_1-summary" class="sidebar-link">1. Summary</a></li><li class="sidebar-sub-header"><a href="/specifications/text/0089-tenant-tokens.html#_2-motivation" class="sidebar-link">2. Motivation</a></li><li class="sidebar-sub-header"><a href="/specifications/text/0089-tenant-tokens.html#_3-functional-specification" class="sidebar-link">3. Functional Specification</a></li><li class="sidebar-sub-header"><a href="/specifications/text/0089-tenant-tokens.html#_4-future-possibilities" class="sidebar-link">4. Future Possibilities</a></li></ul></li><li><a href="/specifications/text/0096-auto-batching.html" class="sidebar-link">Auto batching</a></li><li><a href="/specifications/text/0105-dumps-api.html" class="sidebar-link">Dumps api</a></li><li><a href="/specifications/text/0117-typo-tolerance-setting-api.html" class="sidebar-link">Typo tolerance setting api</a></li><li><a href="/specifications/text/0118-search-api.html" class="sidebar-link">Search api</a></li><li><a href="/specifications/text/0119-instance-options.html" class="sidebar-link">Instance options</a></li><li><a href="/specifications/text/0121-data-types.html" class="sidebar-link">Data types</a></li><li><a href="/specifications/text/0123-displayed-attributes-setting-api.html" class="sidebar-link">Displayed attributes setting api</a></li><li><a href="/specifications/text/0123-distinct-attribute-setting-api.html" class="sidebar-link">Distinct attribute setting api</a></li><li><a href="/specifications/text/0123-filterable-attributes-setting-api.html" class="sidebar-link">Filterable attributes setting api</a></li><li><a href="/specifications/text/0123-proximity-precision.html" class="sidebar-link">Proximity precision</a></li><li><a href="/specifications/text/0123-ranking-rules-setting-api.html" class="sidebar-link">Ranking rules setting api</a></li><li><a href="/specifications/text/0123-searchable-attributes-setting-api.html" class="sidebar-link">Searchable attributes setting api</a></li><li><a href="/specifications/text/0123-separators-settings-api.html" class="sidebar-link">Separators settings api</a></li><li><a href="/specifications/text/0123-settings-api.html" class="sidebar-link">Settings api</a></li><li><a href="/specifications/text/0123-sortable-attributes-setting-api.html" class="sidebar-link">Sortable attributes setting api</a></li><li><a href="/specifications/text/0123-stop-words-setting-api.html" class="sidebar-link">Stop words setting api</a></li><li><a href="/specifications/text/0123-synonyms-setting-api.html" class="sidebar-link">Synonyms setting api</a></li><li><a href="/specifications/text/0123-user-dictionary-settings-api.html" class="sidebar-link">User dictionary settings api</a></li><li><a href="/specifications/text/0124-documents-api.html" class="sidebar-link">Documents api</a></li><li><a href="/specifications/text/0132-indexes-api.html" class="sidebar-link">Indexes api</a></li><li><a href="/specifications/text/0134-stats-api.html" class="sidebar-link">Stats api</a></li><li><a href="/specifications/text/0135-indexing-json.html" class="sidebar-link">Indexing json</a></li><li><a href="/specifications/text/0136-documents-soft-deletion.html" class="sidebar-link">Documents soft deletion</a></li><li><a href="/specifications/text/0171-version-api.html" class="sidebar-link">Version api</a></li><li><a href="/specifications/text/0172-health-api.html" class="sidebar-link">Health api</a></li><li><a href="/specifications/text/0174-metrics-api.html" class="sidebar-link">Metrics api</a></li><li><a href="/specifications/text/0178-compression-headers.html" class="sidebar-link">Compression headers</a></li><li><a href="/specifications/text/0185-configuration-file.html" class="sidebar-link">Configuration file</a></li><li><a href="/specifications/text/0191-swap-indexes-api.html" class="sidebar-link">Swap indexes api</a></li><li><a href="/specifications/text/0192-multi-search-api.html" class="sidebar-link">Multi search api</a></li><li><a href="/specifications/text/0193-experimental-features.html" class="sidebar-link">Experimental features</a></li><li><a href="/specifications/text/0194-experimental-feature-api.html" class="sidebar-link">Experimental feature api</a></li><li><a href="/specifications/text/0195-ranking-score.html" class="sidebar-link">Ranking score</a></li><li><a href="/specifications/text/0246-facet-search-api.html" class="sidebar-link">Facet search api</a></li><li><a href="/specifications/text/0258-snapshots-api.html" class="sidebar-link">Snapshots api</a></li><li><a href="/specifications/text/0262-task-queue-webhook.html" class="sidebar-link">Task queue webhook</a></li><li><a href="/specifications/text/157-faceting-setting-api.html" class="sidebar-link">Aceting setting api</a></li><li><a href="/specifications/text/157-pagination-setting-api.html" class="sidebar-link">Agination setting api</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><ul><li>Title: Tenant Tokens</li></ul> <h1 id="tenant-tokens"><a href="#tenant-tokens" class="header-anchor">#</a> Tenant Tokens</h1> <h2 id="_1-summary"><a href="#_1-summary" class="header-anchor">#</a> 1. Summary</h2> <p>A <code>Tenant token</code> is generated by the user code to be used by an end-user when making search queries.</p> <p>It allows users to have multi-tenant indexes and thus restricts access to documents depending on the end-user making the search request.</p> <p>A Tenant Token is a JWT containing the information necessary for Meilisearch to verify it and extract permission/rules to apply it to the end user's search.</p> <h3 id="_1-1-key-points"><a href="#_1-1-key-points" class="header-anchor">#</a> 1.1. Key Points</h3> <ul><li><code>Tenant tokens</code> are JWTs generated on the user side by using Meilisearch SDKs or their custom code. <code>Tenant tokens</code> are not stored nor retrievable on the Meilisearch side.</li> <li><code>Tenant tokens</code> contain rules that ensure that a <code>Tenant token</code> holder (e.g. an end-user) only has access to documents matching rules chosen at the <code>tenant token</code> creation.</li> <li><code>Tenant tokens</code> are signed from a Meilisearch <code>API key</code> resource on the user's code.</li> <li><code>Tenant tokens</code> must not be signed by the master key.</li> <li><code>Tenant tokens</code> cannot be more permissive than the signing <code>API key</code>.</li> <li><code>Tenant tokens</code> must be signed by an <code>API Key</code> having the <code>search</code> action defined.</li> <li><code>Tenant tokens</code> can have different rules for each index accessible by the signing API key. These rules are described in the <code>searchRules</code> JSON object.</li> <li>The only rule available in the <code>searchRules</code> object is the search parameter <code>filter</code>.</li> <li><code>Tenant tokens</code> are sent to Meilisearch via the <code>Authorization</code> header like any <code>API Keys</code> or the master key.</li> <li>When Meilisearch receives a search query emitted with a <code>Tenant token</code>, the <code>tenant token</code> is decoded, then the <code>searchRules</code> are applied for the search request before the search parameters.</li></ul> <h2 id="_2-motivation"><a href="#_2-motivation" class="header-anchor">#</a> 2. Motivation</h2> <p><code>Tenant tokens</code> are introduced to solve multi-tenant indexes use-case.</p> <blockquote><p>Multi-Tenant Indexes Definition: It is an index that stores documents that may belong to different tenants. In our case, a tenant within an index can be a user or a company, etc. In general, the data of one tenant should not be accessible by other tenants.</p></blockquote> <p>Users today need to set up workarounds to have multi-tenant indexes. They have to use server code to implement the access restriction logic before requesting Meilisearch. It isn't easy to maintain, to implement, and the performance is not optimal because the frontend code does not communicate directly with Meilisearch.</p> <h2 id="_3-functional-specification"><a href="#_3-functional-specification" class="header-anchor">#</a> 3. Functional Specification</h2> <h3 id="_3-1-example-solving-multi-tenancy-with-tenant-tokens"><a href="#_3-1-example-solving-multi-tenancy-with-tenant-tokens" class="header-anchor">#</a> 3.1. Example: Solving Multi-Tenancy with <code>Tenant tokens</code></h3> <p><img src="https://user-images.githubusercontent.com/3692335/151013496-d33ab507-f972-465d-b942-899fc2bd0a22.png" alt=""></p> <p><code>Mark</code> is a developer for a SaaS platform. He would like to ensure that every end-user can only access their documents at search time.</p> <p>When an end-user registers, Mark's backend code generates a <code>Tenant token</code> for that end-user so they can only access their documents at search time.</p> <p>This tenant-token is signed with a Meilisearch API Key so that Meilisearch can ensure that the tenant-token has been generated from a known entity.</p> <p>Meilisearch checks if the Tenant Token is authorized to make the search request.</p> <p>Then Meilisearch extracts the Tenant Token's rules to apply for the search request.</p> <h3 id="_3-2-tenant-token-details"><a href="#_3-2-tenant-token-details" class="header-anchor">#</a> 3.2. <code>Tenant Token</code> Details</h3> <p>Tenant Tokens are JWTs and must respect several conditions to be understandable by a Meilisearch instance.</p> <h4 id="_3-2-1-header-algorithm-and-token-type"><a href="#_3-2-1-header-algorithm-and-token-type" class="header-anchor">#</a> 3.2.1. Header: Algorithm and token type</h4> <p>The Tenant Token must be signed with one of the following algorithms:</p> <ul><li><code>HS256</code></li> <li><code>HS384</code></li> <li><code>HS512</code></li></ul> <p>e.g. With <code>HS256</code></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;alg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;HS256&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;typ&quot;</span><span class="token operator">:</span> <span class="token string">&quot;JWT&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The secret key that is used to encrypt the JWT token must be the original API Key value (not the UID).</p> <h4 id="_3-2-2-payload-data"><a href="#_3-2-2-payload-data" class="header-anchor">#</a> 3.2.2. Payload: Data</h4> <p>Meilisearch needs information within the tenant token to check its validity and use it to authorize and perform end-user search requests.</p> <h5 id="_3-2-2-1-validity-information"><a href="#_3-2-2-1-validity-information" class="header-anchor">#</a> 3.2.2.1. Validity Information</h5> <table><thead><tr><th>Fields</th> <th>Required</th> <th>Description</th> <th>Comments</th></tr></thead> <tbody><tr><td><code>apiKeyUid</code> (Custom claim)</td> <td>Required</td> <td>Must contain the <code>uid</code> field value of the signing <code>Meilisearch API key</code> used to generate the JWT</td> <td></td></tr> <tr><td><code>exp</code> (Expiration Time claim)</td> <td>Optional</td> <td>A JSON numeric value representing the number of seconds from 1970-01-01T00:00:00Z UTC until the specified UTC date/time.</td> <td>If the signing API key expires, the Tenant Token also expires. Thus said, the <code>exp</code> can't be greater than the expiration date of the signing API key.</td></tr></tbody></table> <h6 id="_3-2-2-1-1-apikeyuid-field"><a href="#_3-2-2-1-1-apikeyuid-field" class="header-anchor">#</a> 3.2.2.1.1. <code>apiKeyUid</code> field</h6> <p><code>apiKeyUid</code> permits to verify that the signing API key of the Token is known and valid within Meilisearch. It must contain the <code>uid</code> field value of the Meilisearch API key that generates and signs the Tenant Token.</p> <p>The <code>apiKeyUid</code> can't be generated from the master key, and the <code>API Key</code> must have the <code>search</code> action defined to generate a usable tenant token.</p> <h6 id="_3-2-2-1-2-exp-field"><a href="#_3-2-2-1-2-exp-field" class="header-anchor">#</a> 3.2.2.1.2. <code>exp</code> field</h6> <p><code>exp</code> is used to specify the expiration date of the Tenant Token if needed. The format is a JSON numeric value representing the number of seconds from 1970-01-01T00:00:00Z UTC until the specified UTC date/time, ignoring leap seconds.</p> <h5 id="_3-2-2-2-business-logic-information"><a href="#_3-2-2-2-business-logic-information" class="header-anchor">#</a> 3.2.2.2. Business Logic Information</h5> <table><thead><tr><th>Fields</th> <th>Required</th> <th>Description</th> <th>Comments</th></tr></thead> <tbody><tr><td><code>searchRules</code></td> <td>Required</td> <td>This JSON object contains rules to apply for search queries performed with the JWT depending on the searched index. A Tenant Token cannot access more indexes at search time than those defined as accessible by the signing API key.</td> <td>Let's say an index uses a field to separate documents belonging to one end-user from another one, but another index needs to separate belonging using a different field in its schema. Defining specific search rules per accessible index avoids generating several tenant tokens for an end-user.</td></tr></tbody></table> <h6 id="_3-2-2-2-1-searchrules-json-object"><a href="#_3-2-2-2-1-searchrules-json-object" class="header-anchor">#</a> 3.2.2.2.1. <code>searchRules</code> JSON object</h6> <p><code>searchRules</code> contains the rules to be enforced at search time for all or specific accessible indexes for the signing API Key.</p> <p>Here are the accepted formats for the <code>searchRules</code> property.</p> <hr> <blockquote><p>In this case, all indexes on which the signing API Key has permissions are searchable by the tenant token without any restrictions.</p></blockquote> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;searchRules&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;*&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>is equivalent to</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;searchRules&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;*&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>is equivalent to</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;searchRules&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The search is authorized on all accessible indexes from the signing API Key for the Tenant Token without specific rules.</p> <hr> <blockquote><p>In this case, all searchable indexes from the signing API Key are searchable by the tenant token, and Meilisearch applies the <code>filter</code> search rule before applying the request search parameters.</p></blockquote> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;searchRules&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;*&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;filter&quot;</span><span class="token operator">:</span> <span class="token string">&quot;user_id = 1&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><hr> <blockquote><p>In this case, if the <code>medical_records</code> index is searchable from the signing API Key, the tenant token is only authorized to search in the <code>medical_records</code> index.</p></blockquote> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;searchRules&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;medical_records&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>is equivalent to</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;searchRules&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;medical_records&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>is equivalent to</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;searchRules&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;medical_records&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><hr> <blockquote><p>In this case, if the <code>medical_records</code> index is searchable from the signing API Key, the tenant token is only authorized to search in the <code>medical_records</code> index, and Meilisearch applies the <code>filter</code> search rule before applying the request search parameters.</p></blockquote> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;searchRules&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;medical_records&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;filter&quot;</span><span class="token operator">:</span> <span class="token string">&quot;user_id = 1&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><hr> <blockquote><p>In this case, if the <code>medical_records</code> and <code>medical_appointments</code> indexes are searchable from the signing API Key, the tenant token is only authorized to search in those indexes, and Meilisearch applies the <code>filter</code> search rule before applying the request search parameters.</p></blockquote> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;searchRules&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;medical_records&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;filter&quot;</span><span class="token operator">:</span> <span class="token string">&quot;user_id = 1&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;medical_appointments&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;filter&quot;</span><span class="token operator">:</span> <span class="token string">&quot;user_id = 1 AND accepted = true&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><hr> <blockquote><p>In this case, all searchable indexes from the signing API Key are searchable, and Meilisearch applies the <code>filter</code> search rule before applying the request search parameters for all indexes except for the <code>medical_appointments</code> index. A dedicated <code>filter</code> search rule is applied when making a search query on this index.</p></blockquote> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;searchRules&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;*&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;filter&quot;</span><span class="token operator">:</span> <span class="token string">&quot;user_id = 1&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;medical_appointments&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;filter&quot;</span><span class="token operator">:</span> <span class="token string">&quot;user_id = 1 AND accepted = true&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><hr> <blockquote><p>The <code>filter</code> field accepts an array, a string, and the mixed syntax as described in the <a href="/specifications/text/0118-search-api.html#312-filter">Search Endpoints Specification</a>.</p></blockquote> <h5 id="_3-2-2-3-payload-example"><a href="#_3-2-2-3-payload-example" class="header-anchor">#</a> 3.2.2.3. Payload example</h5> <p>Given a Meilisearch API Key used to sign the JWT from the user code. Here is an example of a valid payload for a tenant token.</p> <p>e.g. <code>Meilisearch API key: rkDxFUHd02193e120218f72cc51a9db62729fdb4003e271f960d1631b54f3426fa8b2595</code></p> <div class="language-jsonc extra-class"><pre class="language-text"><code>{
    &quot;apiKeyUid&quot;: &quot;f0ec9882-0184-4303-89f0-d4c4d6912bcf&quot;, // The uid field value of the signing Meilisearch API Key
    &quot;exp&quot;: 1641835850, // An expiration date in seconds from 1970-01-01T00:00:00Z UTC
    &quot;searchRules&quot;: { // The searchRules Json Object definition
        &quot;*&quot;: {
            &quot;filter&quot;: &quot;user_id = 1&quot;
        }
    }
}
</code></pre></div><blockquote><p>In this example, <code>&quot;*&quot;</code> allows to specify that no matter which index is searched (among all those accessible by the signing API key that generated the tenant token), the <code>filter</code> search rule is applied on all search requests.</p></blockquote> <h3 id="_3-3-tenant-token-revokation"><a href="#_3-3-tenant-token-revokation" class="header-anchor">#</a> 3.3. Tenant Token Revokation</h3> <p>It is not possible to revoke a  specific tenant token.</p> <p>The only way to do so is to <strong>delete the API key that signed it</strong> using the <code>DELETE - /keys/:apiKey</code> endpoints of Meilisearch.</p> <p>🚨 <strong>Doing this revoke all tenant tokens signed by this API Key.</strong></p> <p>Another much more drastic method is to modify the <code>master key</code> of the Meilisearch instance.</p> <p>🚨🚨 <strong>Doing this regenerate all the API Keys and thus revoke all the tenant tokens generated regardless of the signing API Key.</strong></p> <h2 id="_4-future-possibilities"><a href="#_4-future-possibilities" class="header-anchor">#</a> 4. Future Possibilities</h2> <ul><li>Handle more signing methods for the Tenant Token.</li> <li>Handle more search parameters restrictions in <code>searchRules</code>.</li> <li>Add a possibility to revoke a specific Tenant Token.</li> <li>Introduce an endpoint to generate tenant tokens on the Meilisearch side.</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/specifications/text/0085-api-keys.html" class="prev">
        Api keys
      </a></span> <span class="next"><a href="/specifications/text/0096-auto-batching.html">
        Auto batching
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.9e995259.js" defer></script><script src="/assets/js/3.4da56047.js" defer></script><script src="/assets/js/30.05c7bec9.js" defer></script>
  </body>
</html>
