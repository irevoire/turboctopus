(window.webpackJsonp=window.webpackJsonp||[]).push([[56],{478:function(e,t,s){"use strict";s.r(t);var a=s(62),i=Object(a.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"metrics-api"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#metrics-api"}},[e._v("#")]),e._v(" Metrics API")]),e._v(" "),s("p",[e._v("This endpoint is currently "),s("RouterLink",{attrs:{to:"/specifications/text/0193-experimental-features.html"}},[e._v("experimental")]),e._v(".")],1),e._v(" "),s("p",[e._v("This means that it can break at any time between two minor versions as long as it is not stabilized.")]),e._v(" "),s("h2",{attrs:{id:"_1-summary"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-summary"}},[e._v("#")]),e._v(" 1. Summary")]),e._v(" "),s("p",[e._v("This specification describes the metrics API endpoint with the exhaustive list of returned metrics.")]),e._v(" "),s("p",[e._v("The endpoint returns observability data to monitor a Meilisearch instance using "),s("a",{attrs:{href:"https://prometheus.io/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Prometheus"),s("OutboundLink")],1),e._v(".")]),e._v(" "),s("h2",{attrs:{id:"_2-motivation"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-motivation"}},[e._v("#")]),e._v(" 2. Motivation")]),e._v(" "),s("p",[e._v("Improve the capabilities of a Meilisearch instance regarding observability and ease its integration into monitoring stacks.")]),e._v(" "),s("h2",{attrs:{id:"_3-functional-specification"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-functional-specification"}},[e._v("#")]),e._v(" 3. Functional Specification")]),e._v(" "),s("h3",{attrs:{id:"_3-1-activating-the-feature"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-activating-the-feature"}},[e._v("#")]),e._v(" 3.1. Activating the feature")]),e._v(" "),s("p",[e._v("By default, the "),s("code",[e._v("/metrics")]),e._v(" endpoint is not accessible. To activate it, the "),s("code",[e._v("--experimental-enable-metrics")]),e._v(" CLI option or "),s("code",[e._v("MEILI_EXPERIMENTAL_ENABLE_METRICS")]),e._v(" env var must be specified at launch. See "),s("RouterLink",{attrs:{to:"/specifications/text/0119-instance-options.html"}},[e._v("Instance Options")])],1),e._v(" "),s("h3",{attrs:{id:"_3-2-metrics-api-resource-definition"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-metrics-api-resource-definition"}},[e._v("#")]),e._v(" 3.2. "),s("code",[e._v("metrics")]),e._v(" API resource definition")]),e._v(" "),s("p",[e._v("Prometheus metrics format is text-based and line-oriented. Lines are separated by a line feed character (n).")]),e._v(" "),s("p",[e._v("A metric is composed of several fields:")]),e._v(" "),s("ul",[s("li",[s("code",[e._v("# HELP")]),e._v(" metadata")]),e._v(" "),s("li",[s("code",[e._v("# TYPE")]),e._v(" metadata")]),e._v(" "),s("li",[e._v("Metric name")]),e._v(" "),s("li",[e._v("Current metric value")])]),e._v(" "),s("p",[e._v("Meilisearch returns the metrics specified in the table below.")]),e._v(" "),s("table",[s("thead",[s("tr",[s("th",[e._v("Name")]),e._v(" "),s("th",[e._v("Type")])])]),e._v(" "),s("tbody",[s("tr",[s("td",[s("a",{attrs:{href:"#321-meilisearch_http_requests_total"}},[s("code",[e._v("meilisearch_http_requests_total")])])]),e._v(" "),s("td",[e._v("counter")])]),e._v(" "),s("tr",[s("td",[s("a",{attrs:{href:"#322-meilisearch_http_response_time_seconds"}},[s("code",[e._v("meilisearch_http_response_time_seconds")])])]),e._v(" "),s("td",[e._v("histogram")])]),e._v(" "),s("tr",[s("td",[s("a",{attrs:{href:"#323-meilisearch_db_size_bytes"}},[s("code",[e._v("meilisearch_db_size_bytes")])])]),e._v(" "),s("td",[e._v("gauge")])]),e._v(" "),s("tr",[s("td",[s("a",{attrs:{href:"#324-meilisearch_used_db_size_bytes"}},[s("code",[e._v("meilisearch_used_db_size_bytes")])])]),e._v(" "),s("td",[e._v("gauge")])]),e._v(" "),s("tr",[s("td",[s("a",{attrs:{href:"#325-meilisearch_index_docs_count"}},[s("code",[e._v("meilisearch_index_docs_count")])])]),e._v(" "),s("td",[e._v("gauge")])]),e._v(" "),s("tr",[s("td",[s("a",{attrs:{href:"#326-meilisearch_index_count"}},[s("code",[e._v("meilisearch_index_count")])])]),e._v(" "),s("td",[e._v("gauge")])]),e._v(" "),s("tr",[s("td",[s("a",{attrs:{href:"#327-meilisearch_nb_tasks"}},[s("code",[e._v("meilisearch_nb_tasks")])])]),e._v(" "),s("td",[e._v("counter")])]),e._v(" "),s("tr",[s("td",[s("a",{attrs:{href:"#328-meilisearch_last_update"}},[s("code",[e._v("meilisearch_last_update")])])]),e._v(" "),s("td",[e._v("gauge")])]),e._v(" "),s("tr",[s("td",[s("a",{attrs:{href:"#329-meilisearch_is_indexing"}},[s("code",[e._v("meilisearch_is_indexing")])])]),e._v(" "),s("td",[e._v("gauge")])])])]),e._v(" "),s("h4",{attrs:{id:"_3-2-1-meilisearch-http-requests-total"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-1-meilisearch-http-requests-total"}},[e._v("#")]),e._v(" 3.2.1 "),s("code",[e._v("meilisearch_http_requests_total")])]),e._v(" "),s("p",[e._v("Returns the number of times an API resource is accessed.")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('# HELP http_requests_total HTTP requests total\n# TYPE http_requests_total counter\nmeilisearch_http_requests_total{method=":httpMethod",path=":resourcePath"} :numberOfRequest\n')])])]),s("h4",{attrs:{id:"_3-2-2-meilisearch-http-response-time-seconds"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-2-meilisearch-http-response-time-seconds"}},[e._v("#")]),e._v(" 3.2.2. "),s("code",[e._v("meilisearch_http_response_time_seconds")])]),e._v(" "),s("p",[e._v("Returns a time histogram showing the number of times an API resource call goes into a time bucket (expressed in second).")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('# HELP http_response_time_seconds HTTP response times\n# TYPE http_response_time_seconds histogram\nhttp_response_time_seconds_bucket{method=":httpMethod",path=":resourcePath",le="0.0005"} :numberOfRequest\nhttp_response_time_seconds_bucket{method=":httpMethod",path=":resourcePath",le="0.0008"} :numberOfRequest\nhttp_response_time_seconds_bucket{method=":httpMethod",path=":resourcePath",le="0.00085"} :numberOfRequest\nhttp_response_time_seconds_bucket{method=":httpMethod",path=":resourcePath",le="0.0009"} :numberOfRequest\nhttp_response_time_seconds_bucket{method=":httpMethod",path=":resourcePath",le="0.00095"} :numberOfRequest\nhttp_response_time_seconds_bucket{method=":httpMethod",path=":resourcePath",le="0.001"} :numberOfRequest\nhttp_response_time_seconds_bucket{method=":httpMethod",path=":resourcePath",le="0.00105"} :numberOfRequest\nhttp_response_time_seconds_bucket{method=":httpMethod",path=":resourcePath",le="0.0011"} :numberOfRequest\nhttp_response_time_seconds_bucket{method=":httpMethod",path=":resourcePath",le="0.00115"} :numberOfRequest\nhttp_response_time_seconds_bucket{method=":httpMethod",path=":resourcePath",le="0.0012"} :numberOfRequest\nhttp_response_time_seconds_bucket{method=":httpMethod",path=":resourcePath",le="0.0015"} :numberOfRequest\nhttp_response_time_seconds_bucket{method=":httpMethod",path=":resourcePath",le="0.002"} :numberOfRequest\nhttp_response_time_seconds_bucket{method=":httpMethod",path=":resourcePath",le="0.003"} :numberOfRequest\nhttp_response_time_seconds_bucket{method=":httpMethod",path=":resourcePath",le="1"} :numberOfRequest\nhttp_response_time_seconds_bucket{method=":httpMethod",path=":resourcePath",le="+Inf"} :numberOfRequest\nhttp_response_time_seconds_sum{method=":httpMethod",path=":resourcePath"} :numberOfRequest\nmeilisearch_http_response_time_seconds_count{method=":httpMethod",path=":resourcePath"} :numberOfRequest\n')])])]),s("h4",{attrs:{id:"_3-2-3-meilisearch-db-size-bytes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-3-meilisearch-db-size-bytes"}},[e._v("#")]),e._v(" 3.2.3. "),s("code",[e._v("meilisearch_db_size_bytes")])]),e._v(" "),s("p",[e._v("Returns the “real” size of the database on disk in bytes.\nIt includes all the lmdb memory mapped files plus all the files contained in the "),s("code",[e._v("data.ms")]),e._v(" directory (mainly the updates files that were not processed yet).")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("# HELP meilisearch_db_size_bytes Meilisearch Db Size In Bytes\n# TYPE meilisearch_db_size_bytes gauge\nmeilisearch_db_size_bytes :databaseSizeInBytes\n")])])]),s("h4",{attrs:{id:"_3-2-4-meilisearch-used-db-size-bytes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-4-meilisearch-used-db-size-bytes"}},[e._v("#")]),e._v(" 3.2.4. "),s("code",[e._v("meilisearch_used_db_size_bytes")])]),e._v(" "),s("p",[e._v("Returns the size of the database actually used by meilisearch in bytes.\nInclude all the same files as "),s("code",[e._v("meilisearch_db_size_bytes")]),e._v(" except that when it comes to an LMDB database, we only count the pages used by meilisearch.\nThis means if you see a large gap between both metrics, adding documents will probably re-use freed pages instead of growing "),s("code",[e._v("meilisearch_db_size_bytes")]),e._v(".")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("# HELP meilisearch_used_db_size_bytes Meilisearch Used DB Size In Bytes\n# TYPE meilisearch_used_db_size_bytes gauge\nmeilisearch_used_db_size_bytes :databaseSizeInBytes\n")])])]),s("h4",{attrs:{id:"_3-2-5-meilisearch-index-docs-count"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-5-meilisearch-index-docs-count"}},[e._v("#")]),e._v(" 3.2.5. "),s("code",[e._v("meilisearch_index_docs_count")])]),e._v(" "),s("p",[e._v("Returns the number of documents for an index.")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('# HELP meilisearch_index_docs_count Meilisearch Index Docs Count\n# TYPE meilisearch_index_docs_count gauge\nmeilisearch_index_docs_count{index=":indexUid"} :numberOfDocuments\n')])])]),s("h4",{attrs:{id:"_3-2-6-meilisearch-index-count"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-6-meilisearch-index-count"}},[e._v("#")]),e._v(" 3.2.6. "),s("code",[e._v("meilisearch_index_count")])]),e._v(" "),s("p",[e._v("Returns the total number of indexes for the Meilisearch instance.")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("# HELP meilisearch_index_count Meilisearch Index Count\n# TYPE meilisearch_index_count gauge\nmeilisearch_index_count :numberOfIndex\n")])])]),s("h4",{attrs:{id:"_3-2-7-meilisearch-nb-tasks"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-7-meilisearch-nb-tasks"}},[e._v("#")]),e._v(" 3.2.7. "),s("code",[e._v("meilisearch_nb_tasks")])]),e._v(" "),s("p",[e._v("Returns the total number of tasks for the Meilisearch instance parametrized by the kind of task and its value (see the table below).")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('# HELP meilisearch_nb_tasks Meilisearch Number of tasks\n# TYPE meilisearch_nb_tasks gauge\nmeilisearch_nb_tasks{kind=":kind",value=":value"} :number\n')])])]),s("p",[e._v("Here is a list of available kind and associated values:")]),e._v(" "),s("table",[s("thead",[s("tr",[s("th",[e._v("Kind")]),e._v(" "),s("th",[e._v("values")])])]),e._v(" "),s("tbody",[s("tr",[s("td",[e._v("indexes")]),e._v(" "),s("td",[e._v("Any created indexes")])]),e._v(" "),s("tr",[s("td",[e._v("statuses")]),e._v(" "),s("td",[e._v("Any task statuses (i.e.: succeeded, failed, enqueued, etc...)")])]),e._v(" "),s("tr",[s("td",[e._v("types")]),e._v(" "),s("td",[e._v("Any task types (i.e.: documentAdditionOrUpdate, settingsUpdate, etc...)")])])])]),e._v(" "),s("h4",{attrs:{id:"_3-2-8-meilisearch-last-update"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-8-meilisearch-last-update"}},[e._v("#")]),e._v(" 3.2.8. "),s("code",[e._v("meilisearch_last_update")])]),e._v(" "),s("p",[e._v("Returns the timestamp of the last update.")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("# HELP meilisearch_last_update Meilisearch Last Update\n# TYPE meilisearch_last_update gauge\nmeilisearch_last_update :unixTimestamp\n")])])]),s("h4",{attrs:{id:"_3-2-8-meilisearch-is-indexing"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-8-meilisearch-is-indexing"}},[e._v("#")]),e._v(" 3.2.8. "),s("code",[e._v("meilisearch_is_indexing")])]),e._v(" "),s("p",[e._v("Returns "),s("code",[e._v("1")]),e._v(" if Meilisearch is indexing or "),s("code",[e._v("0")]),e._v(" if not.")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("# HELP meilisearch_is_indexing Meilisearch Is Indexing\n# TYPE meilisearch_is_indexing gauge\nmeilisearch_is_indexing :isIndexing\n")])])]),s("h3",{attrs:{id:"_3-3-api-endpoints-definition"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-api-endpoints-definition"}},[e._v("#")]),e._v(" 3.3. API Endpoints Definition")]),e._v(" "),s("h4",{attrs:{id:"_3-3-1-get-metrics"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-1-get-metrics"}},[e._v("#")]),e._v(" 3.3.1. "),s("code",[e._v("GET")]),e._v(" - "),s("code",[e._v("/metrics")])]),e._v(" "),s("p",[e._v("Fetch the metrics of the Meilisearch instance.")]),e._v(" "),s("p",[s("code",[e._v("200")]),e._v(" - Response body example")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('# HELP meilisearch_database_size MeiliSearch Stats DbSize\n# TYPE meilisearch_database_size gauge\nmeilisearch_database_size 1097728\n# HELP meilisearch_docs_count MeiliSearch Stats Docs Count\n# TYPE meilisearch_docs_count gauge\nmeilisearch_docs_count{index="movies"} 807\nmeilisearch_docs_count{index="movies_2"} 0\n# HELP meilisearch_total_index MeiliSearch Stats Index Count\n# TYPE meilisearch_total_index gauge\nmeilisearch_total_index 2\n')])])]),s("h4",{attrs:{id:"_3-3-2-errors"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-2-errors"}},[e._v("#")]),e._v(" 3.3.2. Errors")]),e._v(" "),s("ul",[s("li",[e._v("🔴 If "),s("code",[e._v("--experimental-enable-metrics")]),e._v(" CLI option / "),s("code",[e._v("MEILI_EXPERIMENTAL_ENABLE_METRICS")]),e._v(" env var is not specified at launch, the API returns a "),s("RouterLink",{attrs:{to:"/specifications/text/0061-error-format-and-definitions.html#feature-not-enabled"}},[e._v("feature_not_enabled")]),e._v(" error.")],1)]),e._v(" "),s("h5",{attrs:{id:"_3-3-2-1-auth-errors"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-2-1-auth-errors"}},[e._v("#")]),e._v(" 3.3.2.1 Auth Errors")]),e._v(" "),s("p",[e._v("If a master key is used to secure a Meilisearch instance, the auth layer returns the following errors:")]),e._v(" "),s("ul",[s("li",[e._v("🔴 Accessing this route without the "),s("code",[e._v("Authorization")]),e._v(" header returns a "),s("RouterLink",{attrs:{to:"/specifications/text/0061-error-format-and-definitions.html#missing_authorization_header"}},[e._v("missing_authorization_header")]),e._v(" error.")],1),e._v(" "),s("li",[e._v("🔴 Accessing this route with a key that does not have the permission "),s("code",[e._v("metrics.get")]),e._v(" (i.e. other than the master key) returns an "),s("RouterLink",{attrs:{to:"/specifications/text/0061-error-format-and-definitions.html#invalid_api_key"}},[e._v("invalid_api_key")]),e._v(" error.")],1),e._v(" "),s("li",[e._v("🔴 Accessing this route with a key that has a restriction on the indexes returns an "),s("RouterLink",{attrs:{to:"/specifications/text/0061-error-format-and-definitions.html#invalid_api_key"}},[e._v("invalid_api_key")]),e._v(" error.")],1)]),e._v(" "),s("h2",{attrs:{id:"_4-technical-details"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-technical-details"}},[e._v("#")]),e._v(" 4. Technical Details")]),e._v(" "),s("p",[e._v("N/A")]),e._v(" "),s("h2",{attrs:{id:"_5-future-possibilities"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-future-possibilities"}},[e._v("#")]),e._v(" 5. Future Possibilities")]),e._v(" "),s("ul",[s("li",[e._v("Merge "),s("code",[e._v("/stats")]),e._v(" with "),s("code",[e._v("/metrics")]),e._v(". A header could specify the preferred format. e.g "),s("code",[e._v("application/json")]),e._v(" (similar to actual "),s("code",[e._v("stats")]),e._v(" resource) or "),s("code",[e._v("text/plain")]),e._v(" (Prometheus)")])])])}),[],!1,null,null,null);t.default=i.exports}}]);